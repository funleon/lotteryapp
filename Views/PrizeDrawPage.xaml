<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="lotteryapp.Views.PrizeDrawPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:lotteryapp.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:lotteryapp.ViewModels"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:primitives="using:CommunityToolkit.WinUI.UI.Controls.Primitives"
    mc:Ignorable="d">

    <Grid VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
        <Grid.Background>
            <ImageBrush ImageSource="/Assets/background.png" Stretch="UniformToFill" Opacity="0.8"/>
        </Grid.Background>

        <Grid Padding="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header / Title -->
            <TextBlock Text="{x:Bind ViewModel.Title}" Style="{StaticResource TitleTextBlockStyle}" 
                       Foreground="Black" 
                       HorizontalAlignment="Center" Margin="0,0,0,20"/>

            <!-- Controls Area -->
            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="20" Margin="0,0,0,20">
                <ComboBox ItemsSource="{x:Bind ViewModel.Prizes}" 
                          SelectedItem="{x:Bind ViewModel.SelectedPrize, Mode=TwoWay}"
                          IsEnabled="{x:Bind ViewModel.CanSelectPrize, Mode=OneWay}"
                          DisplayMemberPath="PrizeName"
                          FontSize="20" Foreground="Black"
                          MinWidth="200">
                    <ComboBox.Header>
                        <TextBlock Text="選擇獎項" Foreground="Black" FontWeight="Bold"/>
                    </ComboBox.Header>
                </ComboBox>

                <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                    <TextBlock FontSize="20" Foreground="Black">
                        <Run Text="總獎數: "/>
                        <Run Text="{x:Bind ViewModel.TotalPrizes, Mode=OneWay}"/>
                    </TextBlock>
                    <TextBlock FontSize="20" Foreground="Black">
                        <Run Text="已中獎: "/>
                        <Run Text="{x:Bind ViewModel.WonPrizes, Mode=OneWay}" Foreground="Red"/>
                    </TextBlock>
                </StackPanel>

                <NumberBox Value="{x:Bind ViewModel.DrawCount, Mode=TwoWay}" 
                           IsEnabled="{x:Bind ViewModel.CanSelectPrize, Mode=OneWay}"
                           SpinButtonPlacementMode="Inline"
                           Minimum="1" Maximum="100"
                           FontSize="20" Foreground="Black"
                           MinWidth="120">
                    <NumberBox.Header>
                        <TextBlock Text="抽取人數" Foreground="Black" FontWeight="Bold"/>
                    </NumberBox.Header>
                </NumberBox>

                <Button Content="開始抽獎" 
                        Command="{x:Bind ViewModel.DrawCommand}" 
                        Style="{StaticResource AccentButtonStyle}"
                        FontSize="20" Foreground="White"
                        VerticalAlignment="Bottom"/>
            </StackPanel>

            <!-- Current Rolling Display -->
            <StackPanel Grid.Row="1" VerticalAlignment="Top" HorizontalAlignment="Right" Margin="0,0,20,0">
                 <TextBlock Text="目前中獎人:" Style="{StaticResource SubtitleTextBlockStyle}" 
                            FontSize="20" Foreground="Black"/>
                 <TextBlock Text="{x:Bind ViewModel.CurrentRollingName, Mode=OneWay}" 
                            Style="{StaticResource TitleTextBlockStyle}" 
                            FontSize="20" Foreground="#D32F2F"
                            HorizontalAlignment="Right"/>
            </StackPanel>
            
            <!-- Status Message -->
            <TextBlock Grid.Row="2" Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}" 
                       Foreground="Red" 
                       HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,-10,0,0"/>

            <!-- Winners List -->
            <controls:DataGrid Grid.Row="2" 
                               RequestedTheme="Light"
                               ItemsSource="{x:Bind ViewModel.Winners, Mode=OneWay}"
                               AutoGenerateColumns="False"
                               CanUserSortColumns="True"
                               IsReadOnly="True"
                               GridLinesVisibility="All"
                               BorderThickness="1"
                               BorderBrush="Black"
                               Background="White"
                               RowBackground="White"
                               AlternatingRowBackground="#F2F2F2"
                               Foreground="Black"
                               HorizontalAlignment="Center"
                               HorizontalScrollBarVisibility="Hidden"
                               Margin="0,20,0,0">
                <controls:DataGrid.Resources>
                    <SolidColorBrush x:Key="DataGridColumnHeaderBackgroundBrush" Color="White" />
                    <SolidColorBrush x:Key="DataGridColumnHeaderForegroundBrush" Color="Black" />
                    <Style x:Key="CenterCellStyle" TargetType="TextBlock">
                        <Setter Property="HorizontalAlignment" Value="Center"/>
                        <Setter Property="VerticalAlignment" Value="Center"/>
                        <Setter Property="TextAlignment" Value="Center"/>
                        <Setter Property="Foreground" Value="Black"/>
                        <Setter Property="FontSize" Value="18"/>
                    </Style>
                    <Style x:Key="CenterHeaderStyle" TargetType="primitives:DataGridColumnHeader">
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                        <Setter Property="HorizontalAlignment" Value="Stretch"/>
                        <Setter Property="Foreground" Value="Black"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="FontSize" Value="16"/>
                        <Setter Property="Background" Value="White"/>
                        <Setter Property="BorderBrush" Value="Black"/>
                        <Setter Property="BorderThickness" Value="0,0,1,1"/>
                        <Setter Property="Padding" Value="10,5"/>
                    </Style>
                </controls:DataGrid.Resources>
                <controls:DataGrid.Columns>
                    <controls:DataGridTextColumn Header="順序" Binding="{Binding WinOrder}" Width="200" ElementStyle="{StaticResource CenterCellStyle}" HeaderStyle="{StaticResource CenterHeaderStyle}"/>
                    <controls:DataGridTextColumn Header="部門" Binding="{Binding DeptId}" Width="200" ElementStyle="{StaticResource CenterCellStyle}" HeaderStyle="{StaticResource CenterHeaderStyle}"/>
                    <controls:DataGridTextColumn Header="工號" Binding="{Binding Id}" Width="200" ElementStyle="{StaticResource CenterCellStyle}" HeaderStyle="{StaticResource CenterHeaderStyle}"/>
                    <controls:DataGridTextColumn Header="姓名" Binding="{Binding Name}" Width="200" ElementStyle="{StaticResource CenterCellStyle}" HeaderStyle="{StaticResource CenterHeaderStyle}"/>
                </controls:DataGrid.Columns>
            </controls:DataGrid>
        </Grid>
    </Grid>
</Page>
